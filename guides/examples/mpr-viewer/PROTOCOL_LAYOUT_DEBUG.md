# 协议布局调试指南

如果点击协议布局没有反应，请按照以下步骤进行调试：

## 调试步骤

### 1. 打开浏览器控制台

按 `F12` 或右键点击页面选择"检查"，打开开发者工具。

### 2. 切换到 Console 标签

查看控制台输出。

### 3. 点击协议布局

尝试点击任意协议布局选项，观察控制台输出。

### 4. 预期输出

**正常情况下，您应该看到**：

```
🔄 布局切换请求: mpr
🔄 协议布局 "mpr" 暂时映射到标准 MPR 布局
ℹ️ "MPR 三视图" 协议布局暂时使用标准三视图显示
✅ 布局已切换到: mpr，视口已重新计算大小并重置相机
```

### 5. 常见问题排查

#### 问题 1: 没有任何日志输出

**原因**: 事件处理程序没有绑定

**解决方法**:
1. 检查是否已加载 DICOM 数据
2. 检查 renderingEngine 是否已初始化
3. 查看是否有 JavaScript 错误

#### 问题 2: 看到 "无法切换布局: 渲染引擎或体积数据未初始化"

**原因**: 数据未加载或初始化未完成

**解决方法**:
1. 确保已加载 DICOM 文件
2. 等待初始化完成
3. 刷新页面重试

#### 问题 3: 点击双序列 MPR 布局时提示需要 2 个序列

**原因**: 当前只加载了 1 个序列

**解决方法**:
1. 加载包含多个序列的 DICOM 数据
2. 或先加载其他文件
3. 确认序列面板显示至少 2 个序列

#### 问题 4: 布局切换了但视图没有变化

**原因**: CSS 样式未生效或视口未正确渲染

**解决方法**:
1. 检查 CSS 样式是否正确加载
2. 尝试刷新页面
3. 查看是否有渲染错误

## 测试场景

### 场景 1: 测试标准协议布局

1. 加载任意 DICOM 文件
2. 打开布局面板
3. 切换到"协议布局"标签
4. 点击"MPR 三视图"
5. **预期**: 视图保持为三视图布局
6. **控制台**: 应该看到布局切换日志

### 场景 2: 测试双序列 MPR 布局

1. **前提**: 加载包含至少 2 个序列的 DICOM 数据
2. 打开布局面板
3. 切换到"协议布局"标签
4. 点击"双序列 MPR"
5. **预期**: 显示 6 个视口，2 行 3 列
6. **控制台**: 应该看到 "切换到双序列 MPR 布局" 日志

### 场景 3: 测试其他协议布局

1. 加载任意 DICOM 文件
2. 打开布局面板
3. 切换到"协议布局"标签
4. 点击任意协议布局（如"3D 四视图"）
5. **预期**: 保持为三视图布局（暂时映射）
6. **控制台**: 应该看到 "暂时映射到标准 MPR 布局" 日志

## 已知限制

当前版本中，以下协议布局**暂时映射到标准三视图**：

- ✅ MPR 三视图 (mpr)
- ⚠️ 3D 四视图 (3d-four-up)
- ⚠️ 3D 主视图 (3d-main)
- ⚠️ 轴位主视图 (axial-primary)
- ⚠️ 仅 3D (3d-only)
- ⚠️ 3D 为主 (3d-primary)
- ⚠️ 帧视图 (frame-view)
- ⚠️ 高级视图 (advanced)

**只有以下布局已完整实现**：

- ✅ 所有网格布局 (grid-1x1, grid-1x2, grid-2x2 等)
- ✅ 双序列 MPR (dual-mpr) - 需要至少 2 个序列

## 控制台命令

在控制台中执行以下命令可以检查状态：

```javascript
// 检查当前布局
console.log('当前布局:', currentLayout)

// 检查序列列表
console.log('序列列表:', seriesList)

// 检查视口 ID
console.log('视口 ID:', viewportIds)

// 检查渲染引擎
console.log('渲染引擎:', renderingEngine)

// 检查 volume
console.log('Volume:', volume)
```

## 需要更多信息？

如果问题仍未解决，请提供：

1. 浏览器控制台的完整输出
2. 加载的 DICOM 数据类型
3. 点击的布局选项
4. 预期行为和实际行为的描述

---

**版本**: 1.0
**最后更新**: 2026-01-24
