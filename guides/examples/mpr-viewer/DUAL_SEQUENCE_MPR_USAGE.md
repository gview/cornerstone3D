# 双序列 MPR 布局使用指南

本指南将帮助您使用 MPR Viewer 的双序列 MPR 布局功能进行序列对比。

---

## 快速开始

### 前提条件

1. **加载至少 2 个 DICOM 序列**
   - 双序列 MPR 布局需要两个不同的序列才能工作
   - 可以是同一患者的不同时间点扫描
   - 或者不同序列类型（如 T1 和 T2 MRI）

### 使用步骤

#### 步骤 1: 加载 DICOM 文件

1. 点击工具栏的 **📁 打开文件** 按钮
2. 选择包含多个序列的 DICOM 文件
3. 系统会自动识别并分组序列
4. 序列面板会自动显示，列出所有可用的序列

#### 步骤 2: 检查可用序列

在序列面板中，您应该看到至少 2 个序列，例如：
- **序列 1**: CT 平扫
- **序列 2**: CT 增强

或者：
- **序列 1**: T1 加权
- **序列 2**: T2 加权

#### 步骤 3: 切换到双序列 MPR 布局

1. 点击工具栏的 **▦ 布局** 按钮
2. 在弹出的布局面板中，切换到 **"协议布局"** 标签
3. 找到并点击 **"🔷🔷 双序列 MPR"**
4. 系统会自动应用双序列布局

#### 步骤 4: 查看对比结果

布局应用后，您会看到：

```
┌─────────────┬─────────────┬─────────────┐
│ Seq 1       │ Seq 1       │ Seq 1       │
│ Axial       │ Sagittal    │ Coronal     │
├─────────────┼─────────────┼─────────────┤
│ Seq 2       │ Seq 2       │ Seq 2       │
│ Axial       │ Sagittal    │ Coronal     │
└─────────────┴─────────────┴─────────────┘
```

- **第一行**: 显示序列 1 的三个 MPR 视图
- **第二行**: 显示序列 2 的三个 MPR 视图

---

## 功能特性

### 视口交互

所有视口都支持完整的交互功能：

- **单击**: 激活视口（绿色边框高亮）
- **双击**: 放大视口到全屏
- **滚轮**: 切换切片
- **拖拽**: 移动图像
- **右键拖拽**: 缩放图像

### 十字线同步

- ✅ **序列内同步**: 每个序列的三个视口之间十字线同步
  - 序列 1 的 Axial、Sagittal、Coronal 视口之间同步
  - 序列 2 的 Axial、Sagittal、Coronal 视口之间同步
- ❌ **序列间不同步**: 序列 1 和序列 2 之间不同步
  - 这样可以独立查看两个序列的不同位置

### 工具支持

所有标准工具都可用：

- ✅ 窗宽窗位调整
- ✅ 平移和缩放
- ✅ 测量工具（长度、角度、ROI 等）
- ✅ 十字线工具
- ✅ 切片滚动

---

## 使用场景

### 场景 1: 治疗前后对比

**目的**: 评估治疗效果

**步骤**:
1. 加载治疗前扫描（如术前 CT）
2. 加载治疗后扫描（如术后 CT 或随访 CT）
3. 切换到双序列 MPR 布局
4. 对比相同解剖位置的变化

**示例**:
- 肿瘤大小变化
- 骨折愈合情况
- 术后恢复评估

### 场景 2: 不同序列类型对比

**目的**: 结合不同序列的优缺点进行诊断

**步骤**:
1. 加载 T1 加权 MRI
2. 加载 T2 加权 MRI
3. 切换到双序列 MPR 布局
4. 对比同一位置的信号差异

**示例**:
- **T1**: 显示解剖结构清晰
- **T2**: 显示水肿和病变敏感
- 对比两者可以提高诊断准确性

### 场景 3: CT 增强前后对比

**目的**: 评估强化效果

**步骤**:
1. 加载 CT 平扫序列
2. 加载 CT 增强序列（动脉期或静脉期）
3. 切换到双序列 MPR 布局
4. 观察强化区域

**示例**:
- 肿瘤强化程度
- 血管显示
- 病变血供评估

### 场景 4: 多模态融合参考

**目的**: 结合不同模态的信息

**步骤**:
1. 加载 CT 图像（显示骨结构）
2. 加载 MRI 图像（显示软组织）
3. 切换到双序列 MPR 布局
4. 综合分析

---

## 切换序列

### 方法 1: 通过序列面板切换主序列

1. 在序列面板中点击不同的序列
2. 系统会更新当前显示的主序列
3. 双序列布局会自动更新，显示新选择的序列和另一个可用序列

### 方法 2: 重新应用布局

1. 切换回其他布局（如 1×3 横向）
2. 在序列面板中选择要对比的两个序列
3. 重新切换到双序列 MPR 布局

---

## 性能优化建议

### 硬件要求

双序列 MPR 布局会同时渲染 6 个视口，对硬件要求较高：

**推荐配置**:
- GPU: 独立显卡（如 NVIDIA GTX 1660 或更高）
- 内存: 16GB 或更多
- 处理器: 四核或更高

### 性能提升技巧

1. **降低切片厚度**
   - 减少渲染的切片数量
   - 可以显著提升性能

2. **关闭不必要的工具**
   - 暂时禁用十字线工具
   - 减少实时计算

3. **使用合适的窗宽窗位**
   - 预设窗宽窗位可以减少调整时间

4. **限制测量数量**
   - 过多的测量会影响渲染性能

---

## 故障排除

### 问题 1: 提示"需要至少 2 个序列"

**原因**: 当前只加载了 1 个序列

**解决方法**:
1. 确保加载的 DICOM 文件包含多个序列
2. 检查序列面板是否显示至少 2 个序列
3. 如果只有一个序列，需要加载更多文件

### 问题 2: 两行显示相同的序列

**原因**: 系统找不到第二个不同的序列

**解决方法**:
1. 检查序列列表
2. 确保有多个不同的 Series Instance UID
3. 如果文件来自不同序列，确保它们被正确识别

### 问题 3: 视口显示空白或黑色

**原因**: Volume 数据加载失败或未完成

**解决方法**:
1. 等待几秒让数据完全加载
2. 检查浏览器控制台的错误信息
3. 尝试重新加载序列

### 问题 4: 性能很慢

**原因**: 硬件性能不足或数据量过大

**解决方法**:
1. 降低切片厚度
2. 关闭其他占用资源的程序
3. 使用性能更好的设备
4. 考虑使用 1×3 布局代替

### 问题 5: 十字线不同步

**原因**: 这是正常行为

**说明**:
- 序列 1 内的三个视口会同步
- 序列 2 内的三个视口会同步
- 但序列 1 和序列 2 之间不会同步
- 这样设计是为了允许独立查看两个序列

---

## 键盘快捷键

虽然双序列布局主要使用鼠标交互，但以下快捷键仍然可用：

| 快捷键 | 功能 |
|--------|------|
| `R` | 重置视图 |
| `W` | 切换到窗宽窗位工具 |
| `Z` | 切换到缩放工具 |
| `P` | 切换到平移工具 |
| `C` | 切换到十字线工具（如已启用） |

---

## 最佳实践

### 1. 合理选择对比序列

选择有临床意义的序列对比：
- 治疗前后
- 不同序列类型（T1 vs T2）
- 不同时相（动脉期 vs 静脉期）

### 2. 统一窗宽窗位

为对比的序列设置相似的窗宽窗位：
- 便于观察差异
- 提高对比效果

### 3. 利用同步功能

虽然序列间不同步，但可以：
1. 在序列 1 中找到目标位置
2. 记住切片号
3. 在序列 2 中导航到相似位置

### 4. 测量对比

在两个序列的相同位置进行测量：
- 对比病变大小
- 测量密度或信号变化
- 评估治疗效果

### 5. 截图保存

使用截图功能保存对比结果：
- 用于报告
- 用于教学
- 用于病例讨论

---

## 未来功能

### 计划中的改进

1. **序列选择器**
   - 允许用户选择要对比的两个序列
   - 快速切换序列组合

2. **序列间同步**
   - 可选的序列间位置同步
   - 同步缩放和平移

3. **融合模式**
   - 半透明融合显示
   - 颜色编码融合

4. **差值图像**
   - 自动计算两序列差值
   - 高亮显示变化区域

5. **测量对比**
   - 自动对比两序列的测量值
   - 显示变化趋势

---

## 相关资源

### 文档

- [DUAL_SEQUENCE_MPR_LAYOUT.md](DUAL_SEQUENCE_MPR_LAYOUT.md) - 技术实现文档
- [GRID_1-2_LAYOUT.md](GRID_1-2_LAYOUT.md) - 1|2 主副视图布局
- [LAYOUT_IMPLEMENTATION_SUMMARY.md](LAYOUT_IMPLEMENTATION_SUMMARY.md) - 布局实现总结

### 示例数据

为了测试双序列 MPR 布局，建议使用包含以下内容的 DICOM 数据集：

1. **CT 增强**: 平扫 + 动脉期 + 静脉期
2. **MRI 多序列**: T1 + T2 + FLAIR
3. **随访数据**: 术前 + 术后或不同时间点

---

## 支持

如有问题或建议，请：

1. 查看文档中的故障排除部分
2. 检查浏览器控制台的错误信息
3. 向开发团队反馈

---

**版本**: 1.0
**最后更新**: 2026-01-24
**作者**: Claude Code
