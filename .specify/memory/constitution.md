<!--
同步影响报告
版本变更: 无 → 1.0.0
修改原则:
  - 新增: I. 中文优先
  - 新增: II. 模块化架构
  - 新增: III. 类型安全
  - 新增: IV. 测试覆盖
  - 新增: V. 性能优先
  - 新增: VI. 文档质量
新增章节:
  - 核心原则 (6项原则)
  - 技术标准
  - 开发工作流
  - 治理规则
模板更新状态:
  ✅ plan-template.md - 已检查,无需更新
  ✅ spec-template.md - 已检查,无需更新
  ✅ tasks-template.md - 已检查,无需更新
待办事项: 无
-->

# Cornerstone3D 项目宪章

## 核心原则

### I. 中文优先

所有项目文档、用户交互输出和开发者沟通必须优先使用中文。

- **文档语言**: 项目文档（包括 README、API 文档、指南、注释）必须使用中文编写或提供中文翻译
- **交互输出**: 命令行工具、错误消息、日志输出和用户界面文本必须优先使用中文
- **代码注释**: 源代码中的关键注释必须使用中文，特别是复杂的业务逻辑和算法说明
- **沟通语言**: 项目讨论、Issue、Pull Request 描述和代码审查反馈应使用中文
- **技术术语**: 技术术语可保留英文（如 WebGL、DICOM、TypeScript），但需提供中文解释
- **理由**: Cornerstone3D 是面向全球医疗影像领域的开源项目，中文优先有助于降低中文开发者的使用门槛，提升社区参与度和项目可访问性

### II. 模块化架构

Cornerstone3D 采用 monorepo 架构，所有代码必须遵循模块化设计原则。

- **包独立性**: 每个 packages/ 下的包（core、tools、dicomImageLoader 等）必须可以独立使用、测试和发布
- **依赖方向**: 依赖关系必须单向流动，核心包（core）不能依赖上层包，工具包（tools）可以依赖核心包
- **清晰边界**: 包之间必须通过明确定义的 API 接口交互，禁止直接访问内部实现细节
- **可重用性**: 功能必须设计为可复用的组件，避免代码重复和不必要的耦合
- **理由**: 模块化架构确保项目的可维护性、可扩展性，允许用户按需引入功能，降低包体积和复杂度

### III. 类型安全

TypeScript 类型定义必须完整、准确，并在编译时强制执行。

- **严格模式**: 所有 TypeScript 代码必须启用 strict 模式，禁止使用 `any` 类型（除非有明确注释说明原因）
- **类型覆盖**: 所有公共 API 必须导出完整的类型定义，类型覆盖率必须达到 100%
- **类型导出**: 类型定义必须通过 `.d.ts` 文件或 exported types 明确导出，供使用者使用
- **类型检查**: 提交前必须通过 `tsc --noEmit` 类型检查，禁止存在类型错误
- **理由**: 类型安全在编译时捕获错误，提升代码质量和开发体验，特别是对于医疗影像这种对可靠性要求极高的领域

### IV. 测试覆盖

所有代码变更必须包含相应的测试，确保功能正确性和回归防护。

- **单元测试**: 核心逻辑和工具函数必须有单元测试覆盖，覆盖率目标不低于 80%
- **集成测试**: 跨包交互和关键用户流程必须有集成测试
- **E2E 测试**: 关键用户场景（如影像加载、标注、分割）必须有端到端测试
- **测试类型**: 使用 Karma 运行浏览器单元测试，使用 Jest 运行 Node.js 单元测试，使用 Playwright 运行 E2E 测试
- **测试先行**: 对于新功能开发，鼓励采用 TDD（测试驱动开发）流程
- **理由**: 医疗影像软件的可靠性至关重要，完善的测试体系是质量保证的基石

### V. 性能优先

Cornerstone3D 必须在渲染性能和内存使用上达到生产级别标准。

- **渲染性能**: 影像渲染必须保持 60 FPS，避免阻塞主线程的长时间操作
- **内存管理**: 必须及时清理不再使用的资源（影像数据、WebGL 纹理、缓存），避免内存泄漏
- **懒加载**: 大型数据集（如 volume）必须支持渐进式加载和按需加载
- **Web 优化**: 优先使用 Web Workers 处理计算密集型任务，使用 WebGL/WebGPU 加速渲染
- **性能监控**: 关键路径必须有性能指标监控，支持性能分析和优化
- **理由**: 医疗影像应用通常需要处理大型数据集，性能直接影响用户体验和工作效率

### VI. 文档质量

所有公共 API 和重要功能必须有完整、准确的文档。

- **API 文档**: 所有导出的函数、类、接口必须有 JSDoc/TSDoc 注释，包括参数说明、返回值、使用示例
- **使用指南**: 关键功能必须有详细的使用指南（How-to Guides），包括代码示例和最佳实践
- **概念说明**: 核心概念（如 Viewport、ImageLoader、Annotation）必须有概念文档说明
- **示例代码**: 每个主要功能必须提供可运行的示例代码
- **文档同步**: 代码变更时必须同步更新相关文档，禁止文档与实现不一致
- **理由**: 完善的文档降低学习成本，提升开发者体验，是开源项目成功的关键因素

## 技术标准

### 语言与框架

- **主要语言**: TypeScript 5.5+
- **运行环境**: Node.js 20+, 现代浏览器（Chrome、Firefox、Safari、Edge 最新版本）
- **包管理**: Yarn 1.22+（workspaces 模式）
- **构建工具**: Webpack 5, Rollup, Rspack
- **测试框架**: Jest（单元测试）、Karma（浏览器测试）、Playwright（E2E 测试）

### 代码规范

- **风格指南**: 使用 Prettier 进行代码格式化，使用 oxlint 进行代码检查
- **提交规范**: 遵循 Conventional Commits 规范，提交消息必须清晰描述变更内容
- **代码审查**: 所有代码变更必须经过 Pull Request 和代码审查流程
- **版本管理**: 遵循语义化版本规范（Semantic Versioning）

### 性能标准

- **渲染帧率**: 不低于 60 FPS
- **首屏加载**: 关键功能首屏加载时间不超过 3 秒
- **内存占用**: 单个视口内存占用不超过 200MB（典型场景）
- **并发支持**: 支持至少 10 个并发视口

## 开发工作流

### 功能开发流程

1. **需求分析**: 创建 Issue 讨论功能需求和技术方案
2. **功能规格**: 使用 `/speckit.specify` 创建详细的功能规格文档
3. **实现计划**: 使用 `/speckit.plan` 生成实现计划，包括技术设计、数据模型、API 契约
4. **任务分解**: 使用 `/speckit.tasks` 分解为可执行的开发任务
5. **开发实现**: 按照任务列表逐步实现，每个任务完成后提交代码
6. **测试验证**: 运行相关测试，确保功能正确性和性能达标
7. **代码审查**: 提交 Pull Request，经过团队审查后合并
8. **文档更新**: 更新相关文档和示例代码

### 质量门控

- **类型检查**: 所有代码必须通过 TypeScript 类型检查
- **代码检查**: 所有代码必须通过 oxlint 和 Prettier 检查
- **测试通过**: 所有相关测试必须通过，不允许降低测试覆盖率
- **性能验证**: 性能敏感的功能必须进行性能基准测试
- **文档完整**: 新功能必须有完整的 API 文档和使用指南

### 分支策略

- **主分支**: `main` 分支保持稳定，可直接用于生产环境
- **功能分支**: 从 `main` 分支创建，命名规范为 `feature/###-feature-name` 或 `fix/###-bug-description`
- **合并流程**: 使用 Pull Request 合并，必须通过 CI 检查和代码审查

## 治理规则

### 宪章权威性

- 本宪章是 Cornerstone3D 项目的最高开发准则，优先级高于其他任何开发实践和习惯
- 当其他指南、文档或建议与本宪章冲突时，以本宪章为准
- 所有开发决策都必须符合本宪章规定的原则和标准

### 修订流程

- **修订提案**: 任何人都可以提出修订建议，需说明修订理由和影响范围
- **讨论审核**: 修订提案需经过团队讨论和核心维护者审核
- **版本更新**: 修订通过后必须更新宪章版本号，并记录修订内容和日期
- **迁移计划**: 重大修订需提供迁移计划，帮助现有代码和文档适应新规则

### 版本控制

- **版本格式**: 遵循语义化版本（MAJOR.MINOR.PATCH）
  - **MAJOR**: 移除或重新定义原则，导致向后不兼容的变更
  - **MINOR**: 新增原则或显著扩展现有原则
  - **PATCH**: 文字澄清、错别字修正、非语义性改进
- **当前版本**: 1.0.0（初始版本）

### 合规审查

- **PR 检查清单**: 所有 Pull Request 必须使用宪章检查清单验证合规性
- **CI 集成**: 将宪章合规性检查集成到 CI 流程中
- **违规处理**: 发现违规需立即修复或提供充分理由说明例外情况的必要性
- **定期审查**: 每季度审查一次宪章执行情况，识别改进机会

### 复杂度管理

- **简单优先**: 优先选择最简单的解决方案，避免过度设计
- **复杂度论证**: 如果选择更复杂的方案，必须在文档中明确说明理由和被拒绝的简单方案
- **技术债务**: 对必要的技术债务进行记录，并制定偿还计划

**版本**: 1.0.0 | **批准日期**: 2025-01-18 | **最后修订**: 2025-01-18
